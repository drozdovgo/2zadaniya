<Window x:Class="WpfApp4.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WpfApp4"
        xmlns:vm="clr-namespace:WpfApp4.ViewModels"
        xmlns:conv="clr-namespace:WpfApp4.Converters"
        x:Name="win"
        mc:Ignorable="d"
        Title="Медицинская клиника - Пользователи" Height="600" Width="900" 
        Background="#F5F7FA">

    <Window.Resources>
        <!-- Конвертеры -->
        <conv:RoleToIconConverter x:Key="roleToIconConverter"/>
        <conv:BooleanToBrushConverter x:Key="booleanToBrushConverter"/>
        <conv:BooleanToTextConverter x:Key="booleanToTextConverter"/>

        <!-- Стиль для карточки пользователя -->
        <Style x:Key="UserCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E1E5E9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="2" Opacity="0.1" BlurRadius="8"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataTemplate для пользователя -->
        <DataTemplate x:Key="UserCardTemplate">
            <Border Style="{StaticResource UserCardStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Иконка пользователя -->
                    <TextBlock Grid.Column="0" 
                               Text="{Binding роль, Converter={StaticResource roleToIconConverter}}"
                               FontSize="24"
                               VerticalAlignment="Top"
                               Margin="0,4,12,0"/>

                    <!-- Основная информация -->
                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{Binding ПолноеИмя}" 
                                   FontWeight="Bold" 
                                   FontSize="14"
                                   Foreground="#2C3E50"/>

                        <TextBlock Text="{Binding email}" 
                                   FontSize="12"
                                   Foreground="#666666"
                                   Margin="0,2,0,0"/>

                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="Роль: " 
                                       FontSize="11"
                                       Foreground="#7F8C8D"/>
                            <TextBlock Text="{Binding роль}" 
                                       FontSize="11"
                                       FontWeight="SemiBold"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                            <TextBlock Text="Телефон: " 
                                       FontSize="11"
                                       Foreground="#7F8C8D"/>
                            <TextBlock Text="{Binding телефон}" 
                                       FontSize="11"
                                       FontWeight="SemiBold"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                            <TextBlock Text="Статус: " 
                                       FontSize="11"
                                       Foreground="#7F8C8D"/>
                            <TextBlock Text="{Binding активен, Converter={StaticResource booleanToTextConverter}}"
                                       FontSize="11"
                                       FontWeight="SemiBold"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Индикатор активности -->
                    <Ellipse Grid.Column="2" 
                             Width="12" 
                             Height="12" 
                             VerticalAlignment="Top"
                             HorizontalAlignment="Right"
                             Fill="{Binding активен, Converter={StaticResource booleanToBrushConverter}}"/>
                </Grid>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <d:Window.DataContext>
        <vm:MainWindowViewModel/>
    </d:Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#3498DB" Padding="20,15">
            <TextBlock Text="МЕДИЦИНСКАЯ КЛИНИКА - СИСТЕМА УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ" 
                       Foreground="White" 
                       FontSize="16"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"/>
        </Border>

        <!-- Панель управления -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="16,10" HorizontalAlignment="Center">
            <Button Content="Обновить данные" 
                    Command="{Binding RefreshCommand}"
                    Padding="10,5"
                    Margin="5"/>
            <Button Content="Добавить тестового пользователя" 
                    Command="{Binding AddTestUserCommand}"
                    Padding="10,5"
                    Margin="5"/>
        </StackPanel>

        <!-- Список пользователей -->
        <ItemsControl Grid.Row="2"
                      ItemsSource="{Binding Users}"
                      ItemTemplate="{StaticResource UserCardTemplate}"
                      Margin="16">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" 
                               HorizontalAlignment="Center"
                               VerticalAlignment="Top"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
        </ItemsControl>

        <!-- Статус бар -->
        <StatusBar Grid.Row="3" Background="#ECF0F1">
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Всего пользователей: "/>
                    <Run Text="{Binding TotalUsersCount}" FontWeight="Bold"/>
                </TextBlock>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Активных: "/>
                    <Run Text="{Binding ActiveUsersCount}" FontWeight="Bold" Foreground="Green"/>
                </TextBlock>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Врачей: "/>
                    <Run Text="{Binding DoctorUsersCount}" FontWeight="Bold" Foreground="Blue"/>
                </TextBlock>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding ConnectionStatus}" FontWeight="Bold"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>