<UserControl x:Class="WpfApp4.Views.PatientAppointmentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000">

    <Grid Background="#F5F7FA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Шапка -->
        <Border Grid.Row="0" Background="#3498DB" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding WelcomeMessage}" 
                           Foreground="White" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Обновить" Command="{Binding RefreshCommand}"
                            Background="Transparent" Foreground="White" BorderBrush="White" BorderThickness="1"
                            Padding="15,8" FontWeight="SemiBold" Margin="0,0,10,0"/>
                    <Button Content="Назад" Command="{Binding BackCommand}"
                            Background="Transparent" Foreground="White" BorderBrush="White" BorderThickness="1"
                            Padding="15,8" FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Форма создания записи -->
        <Border Grid.Row="1" Background="White" Margin="10" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Левая колонка: выбор врача -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Новая запись на прием" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

                    <TextBlock Text="Выберите врача:" FontWeight="SemiBold" Margin="0,5,0,5"/>
                    <ComboBox ItemsSource="{Binding Doctors}" 
                      SelectedItem="{Binding SelectedDoctor}"
                      DisplayMemberPath="Пользователь.ПолноеИмя"
                      Padding="10" Margin="0,0,0,10"/>

                    <TextBlock Text="Дата приема:" FontWeight="SemiBold" Margin="0,5,0,5"/>
                    <DatePicker SelectedDate="{Binding SelectedDate}" 
                        Padding="10" Margin="0,0,0,10"/>

                    <TextBlock Text="Время приема:" FontWeight="SemiBold" Margin="0,5,0,5"/>
                    <ComboBox ItemsSource="{Binding AvailableTimes}"
                      SelectedItem="{Binding SelectedTime}"
                      Padding="10" Margin="0,0,0,10">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding StringFormat='hh\\:mm'}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <!-- Правая колонка: симптомы и кнопка -->
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Описание симптомов:" FontWeight="SemiBold" Margin="0,5,0,5"/>
                    <TextBox Text="{Binding Symptoms}" 
                     AcceptsReturn="True" TextWrapping="Wrap" Height="100"
                     Padding="10" Margin="0,0,0,10"/>

                    <Button Content="Записаться на прием" 
                    Command="{Binding CreateAppointmentCommand}"
                    Background="#27AE60" Foreground="White" 
                    FontWeight="Bold" Padding="15,10"/>

                    <!-- Сообщения -->
                    <TextBlock Text="{Binding ErrorMessage}" 
                       Foreground="Red" FontWeight="SemiBold" 
                       Margin="0,10,0,5" TextWrapping="Wrap"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>

                    <TextBlock Text="{Binding SuccessMessage}" 
                       Foreground="Green" FontWeight="SemiBold" 
                       Margin="0,5,0,0" TextWrapping="Wrap"
                       Visibility="{Binding SuccessMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Список записей -->
        <Border Grid.Row="2" Background="White" Margin="10" Padding="15" BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Мои записи:" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Appointments}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" BorderBrush="#E1E5E9" BorderThickness="1" 
                                        Margin="0,0,0,10" Padding="15">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Иконка статуса -->
                                        <Border Grid.Column="0" Width="40" Height="40" 
                                                Background="{Binding статус, Converter={StaticResource StatusToColorConverter}}"
                                                CornerRadius="20" Margin="0,0,15,0">
                                            <TextBlock Text="{Binding статус, Converter={StaticResource StatusToIconConverter}}"
                                                       Foreground="White" FontSize="16" 
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- Информация о записи -->
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding Врач.Пользователь.ПолноеИмя}" 
                                                       FontWeight="Bold" FontSize="14" Foreground="#2C3E50"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                <TextBlock Text="Дата: " FontSize="12" Foreground="#7F8C8D"/>
                                                <TextBlock Text="{Binding дата_записи, StringFormat='dd.MM.yyyy'}" 
                                                           FontSize="12" FontWeight="SemiBold"/>
                                                <TextBlock Text=" | Время: " FontSize="12" Foreground="#7F8C8D" Margin="10,0,0,0"/>
                                                <TextBlock Text="{Binding время_записи, StringFormat='hh\\:mm'}" 
                                                           FontSize="12" FontWeight="SemiBold"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                <TextBlock Text="Специализация: " FontSize="12" Foreground="#7F8C8D"/>
                                                <TextBlock Text="{Binding Врач.Специализация.название}" 
                                                           FontSize="12" FontWeight="SemiBold" Foreground="#3498DB"/>
                                            </StackPanel>

                                            <TextBlock Text="{Binding симптомы}" 
                                                       FontSize="11" Foreground="#666666" Margin="0,5,0,0"
                                                       TextWrapping="Wrap" MaxWidth="500"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                <TextBlock Text="Статус: " FontSize="11" Foreground="#7F8C8D"/>
                                                <TextBlock Text="{Binding статус}" 
                                                           FontSize="11" FontWeight="Bold">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding статус}" Value="запланирована">
                                                                    <Setter Property="Foreground" Value="#3498DB"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding статус}" Value="завершена">
                                                                    <Setter Property="Foreground" Value="#27AE60"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding статус}" Value="отменена">
                                                                    <Setter Property="Foreground" Value="#E74C3C"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Кнопка отмены -->
                                        <Button Grid.Column="2" Content="Отменить запись" 
                                                Command="{Binding DataContext.CancelAppointmentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Background="#E74C3C" Foreground="White" 
                                                Padding="10,5" Margin="10,0,0,0"
                                                Visibility="{Binding статус, Converter={StaticResource StatusToCancelVisibilityConverter}}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Статус бар -->
        <StatusBar Grid.Row="3" Background="#ECF0F1">
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Всего записей: "/>
                    <Run Text="{Binding Appointments.Count, Mode=OneWay}" FontWeight="Bold"/>
                    <Run Text=" | Врачей доступно: "/>
                    <Run Text="{Binding Doctors.Count, Mode=OneWay}" FontWeight="Bold"/>
                </TextBlock>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>